<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC-USDT 交易助手</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .market-data {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .analysis-section {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px;
            background-color: #e9ecef;
        }
        .bullish {
            color: #28a745;
            background-color: #d4edda;
        }
        .bearish {
            color: #dc3545;
            background-color: #f8d7da;
        }
        .neutral {
            color: #6c757d;
            background-color: #e9ecef;
        }
        .volume-info {
            margin: 10px 0;
            padding: 10px;
            background-color: #f1f8ff;
            border-radius: 4px;
        }
        .strategy-card {
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 10px 0;
            background-color: #f8f9fa;
        }
        .risk-level {
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 3px;
        }
        .risk-1 { background-color: #d4edda; color: #155724; }
        .risk-2 { background-color: #fff3cd; color: #856404; }
        .risk-3 { background-color: #ffe5d0; color: #ff8c00; }
        .risk-4 { background-color: #f8d7da; color: #721c24; }
        .risk-5 { background-color: #dc3545; color: white; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">BTC-USDT 交易助手</h1>
        
        <!-- 账户信息 -->
        <div class="analysis-section">
            <h3>账户信息</h3>
            <div id="balance-info">
                <p>BTC 余额: <span id="btc-balance">加载中...</span></p>
                <p>USDT 余额: <span id="usdt-balance">加载中...</span></p>
            </div>
        </div>

        <!-- 市场数据 -->
        <div class="analysis-section">
            <h3>市场数据</h3>
            <div class="market-data" id="market-info">
                <div class="row">
                    <div class="col-md-6">
                        <h4>价格信息</h4>
                        <p>当前价格: <span id="current-price">加载中...</span> USDT</p>
                        <p>24h 价格变化: <span id="price-change">加载中...</span></p>
                    </div>
                    <div class="col-md-6">
                        <h4>成交量信息</h4>
                        <p>24h 成交量: <span id="volume-24h">加载中...</span> BTC</p>
                        <p>成交量变化: <span id="volume-change">加载中...</span></p>
                        <p>24h 成交额: <span id="quote-volume">加载中...</span> USDT</p>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-12">
                        <h4>技术指标</h4>
                        <div class="indicator" id="rsi-indicator">RSI: <span id="rsi-value">加载中...</span></div>
                        <div class="indicator" id="macd-indicator">MACD: <span id="macd-value">加载中...</span></div>
                        <div class="indicator" id="bollinger-indicator">布林带位置: <span id="bollinger-value">加载中...</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 市场分析 -->
        <div class="analysis-section">
            <h3>市场分析</h3>
            <div id="market-analysis">
                <div class="trend-analysis">
                    <h4>趋势分析</h4>
                    <p>市场趋势: <span id="market-trend">加载中...</span></p>
                    <p>支撑位: <span id="support-levels">加载中...</span></p>
                    <p>阻力位: <span id="resistance-levels">加载中...</span></p>
                </div>
                <div class="volume-info">
                    <h4>成交量分析</h4>
                    <p>成交量趋势: <span id="volume-trend">加载中...</span></p>
                    <p>成交量结论: <span id="volume-conclusion">加载中...</span></p>
                </div>
                <div class="technical-analysis">
                    <h4>技术指标分析</h4>
                    <p>RSI分析: <span id="rsi-analysis">加载中...</span></p>
                    <p>MACD分析: <span id="macd-analysis">加载中...</span></p>
                    <p>布林带分析: <span id="bollinger-analysis">加载中...</span></p>
                </div>
                <div class="sentiment-analysis">
                    <h4>市场情绪</h4>
                    <p>情绪评估: <span id="market-sentiment">加载中...</span></p>
                    <p>分析置信度: <span id="analysis-confidence">加载中...</span></p>
                </div>
            </div>
        </div>

        <!-- 交易策略 -->
        <div class="analysis-section">
            <h3>交易策略</h3>
            <div class="strategy-card" id="strategy-info">
                <div class="row">
                    <div class="col-md-6">
                        <h4>操作建议</h4>
                        <p>交易动作: <span id="trade-action">加载中...</span></p>
                        <p>入场价格: <span id="entry-price">加载中...</span></p>
                        <p>止损价格: <span id="stop-loss">加载中...</span></p>
                        <p>止盈价格: <span id="take-profit">加载中...</span></p>
                    </div>
                    <div class="col-md-6">
                        <h4>风险管理</h4>
                        <p>风险等级: <span id="risk-level">加载中...</span></p>
                        <p>仓位建议: <span id="position-size">加载中...</span></p>
                        <p>持仓时间: <span id="time-frame">加载中...</span></p>
                    </div>
                </div>
                <div class="mt-3">
                    <h4>执行条件</h4>
                    <ul id="strategy-conditions">
                        <li>加载中...</li>
                    </ul>
                </div>
                <div class="mt-3">
                    <h4>策略说明</h4>
                    <p id="strategy-reasoning">加载中...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        function updateMarketData() {
            $.get('/api/market_analysis', function(response) {
                if (response.success) {
                    const data = response.data;
                    const market_data = data.market_data;
                    const analysis = data.analysis;
                    const strategy = data.strategy;

                    // 更新市场数据
                    $('#current-price').text(market_data.price.toFixed(2));
                    $('#price-change').text(market_data.price_change_24h.toFixed(2) + '%')
                        .addClass(market_data.price_change_24h >= 0 ? 'bullish' : 'bearish');
                    $('#volume-24h').text(market_data.volume_24h.toFixed(2));
                    $('#volume-change').text(market_data.volume_change_24h.toFixed(2) + '%')
                        .addClass(market_data.volume_change_24h >= 0 ? 'bullish' : 'bearish');
                    $('#quote-volume').text((market_data.quote_volume / 1000000).toFixed(2) + 'M');

                    // 更新技术指标
                    $('#rsi-value').text(market_data.rsi);
                    if (market_data.macd !== 'N/A') {
                        $('#macd-value').text(
                            `${market_data.macd.macd.toFixed(2)} (Signal: ${market_data.macd.signal.toFixed(2)})`
                        );
                    } else {
                        $('#macd-value').text('N/A');
                    }
                    $('#bollinger-value').text(
                        market_data.bollinger_position !== 'N/A' 
                            ? market_data.bollinger_position.toFixed(2) + '%' 
                            : 'N/A'
                    );

                    // 更新市场分析
                    if (analysis && analysis.analysis) {
                        const marketAnalysis = analysis.analysis;
                        $('#market-trend').text(marketAnalysis.trend)
                            .removeClass('bullish bearish neutral')
                            .addClass(marketAnalysis.trend.toLowerCase());
                        $('#support-levels').text(marketAnalysis.support_levels.join(', '));
                        $('#resistance-levels').text(marketAnalysis.resistance_levels.join(', '));
                        
                        // 成交量分析
                        $('#volume-trend').text(marketAnalysis.volume_analysis.volume_trend);
                        $('#volume-conclusion').text(marketAnalysis.volume_analysis.volume_conclusion);
                        
                        // 技术指标分析
                        $('#rsi-analysis').text(marketAnalysis.technical_indicators.rsi_analysis);
                        $('#macd-analysis').text(marketAnalysis.technical_indicators.macd_analysis);
                        $('#bollinger-analysis').text(marketAnalysis.technical_indicators.bollinger_analysis);
                        
                        // 市场情绪
                        $('#market-sentiment').text(marketAnalysis.market_sentiment);
                        $('#analysis-confidence').text((marketAnalysis.confidence * 100).toFixed(2) + '%');
                    }

                    // 更新交易策略
                    if (strategy && strategy.strategy) {
                        const tradingStrategy = strategy.strategy;
                        $('#trade-action').text(tradingStrategy.action.toUpperCase())
                            .removeClass('bullish bearish neutral')
                            .addClass(tradingStrategy.action === 'buy' ? 'bullish' : 
                                    tradingStrategy.action === 'sell' ? 'bearish' : 'neutral');
                        $('#entry-price').text(tradingStrategy.entry_price);
                        $('#stop-loss').text(tradingStrategy.stop_loss);
                        $('#take-profit').text(tradingStrategy.take_profit);
                        $('#risk-level').text(tradingStrategy.risk_level)
                            .removeClass('risk-1 risk-2 risk-3 risk-4 risk-5')
                            .addClass('risk-' + tradingStrategy.risk_level);
                        $('#position-size').text(tradingStrategy.position_size);
                        $('#time-frame').text(tradingStrategy.time_frame);
                        
                        // 更新执行条件
                        const conditionsList = $('#strategy-conditions').empty();
                        tradingStrategy.conditions.forEach(condition => {
                            conditionsList.append(`<li>${condition}</li>`);
                        });
                        
                        $('#strategy-reasoning').text(tradingStrategy.reasoning);
                    }
                }
            });
        }

        // 更新账户余额
        function updateBalance() {
            $.get('/api/balance', function(response) {
                if (response.success) {
                    $('#btc-balance').text(response.data.btc_balance.toFixed(8));
                    $('#usdt-balance').text(response.data.usdt_balance.toFixed(2));
                }
            });
        }

        // 页面加载完成后执行
        $(document).ready(function() {
            updateBalance();
            updateMarketData();
            // 每60秒更新一次数据
            setInterval(function() {
                updateBalance();
                updateMarketData();
            }, 60000);
        });
    </script>
</body>
</html> 